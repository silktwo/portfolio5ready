You are an expert full-stack TypeScript/Node.js developer working inside this Replit project.

Context:
- This project is deployed to Vercel.
- Package manager: pnpm.
- Previously, an AI pass was used to “fix” the Vercel warning about:

  "Ignored build scripts: sharp.
   Run 'pnpm approve-builds' to pick which dependencies should be allowed to run scripts."

- After those automated changes, the app started failing with a runtime error related to the CMS:
  Something like: "Failed to fetch CMS" (or similar wording).
- So: the Vercel/pnpm/sharp issue might be improved, but now the CMS integration is broken.

Your main goals (very important):
1. **Do NOT do a big refactor.**
2. **Do NOT change or remove the pnpm config that was added to allow 'sharp' builds**, unless it is clearly incorrect or syntactically invalid.
3. **Focus on undoing/fixing whatever broke the CMS fetch**, while keeping the minimal pnpm/Vercel fix.

Step-by-step instructions:

1. Inspect recent changes:
   - Use git to see what was changed in the last AI-assisted commit(s), for example:
     - `git log -5 --oneline`
     - `git diff HEAD~1..HEAD`
   - Identify files that were modified by the previous AI pass, especially:
     - `package.json`
     - any CMS-related config files (e.g. `lib/cms.ts`, `lib/api.ts`, `services/cms.ts`, etc.)
     - pages or API routes that fetch content from the CMS (e.g. `/pages`, `/app`, `/api` folders).

2. Locate where the CMS error comes from:
   - Search in the codebase for the string “Failed to fetch CMS” or whatever message is shown in the browser.
   - Find the exact place(s) where the CMS is being called — typical patterns:
     - `fetch(process.env.XXX_CMS_URL...)`
     - a CMS client (e.g. Contentful, Sanity, Strapi, Ghost, etc.).
   - Check what the code looked like **before** the AI changes versus **now**, using `git diff`.

3. Restore / fix CMS logic:
   - If the AI changed the way the CMS URL or token is read from environment variables (for example, renamed env vars, changed from `NEXT_PUBLIC_*` to non-public ones, or vice versa), **restore the previous working pattern** based on the diff.
   - If the AI changed fetch options (e.g. added `cache: "no-store"`, changed HTTP method, changed headers), **revert those changes** to match the last known working version.
   - If a new “CMS wrapper” or error handler was introduced that now throws “Failed to fetch CMS” too aggressively (e.g. on any non-200 status), make that logic more robust:
     - Keep meaningful error handling, but don’t break the whole app if CMS is temporarily unavailable.
   - In short: use the previous commit as the source of truth for how the CMS was working before the AI modifications, and restore that behaviour.

4. Environment variables and Vercel:
   - Verify that the code uses **the same env var names that are actually configured in Vercel**.
   - If the previous working version used `process.env.CMS_URL` (or similar), and the AI changed it to a different name, change it back.
   - Make sure no hard-coded localhost URLs are used for CMS that would fail on Vercel.

5. Keep the pnpm / sharp fix but clean up if needed:
   - Inspect `package.json` and any `pnpm` section.
   - Ensure that the fix for sharp is minimal and valid, e.g.:

     ```json
     "pnpm": {
       "onlyBuiltDependencies": [
         "sharp"
       ]
     }
     ```

   - Do NOT remove this unless it is clearly malformed.
   - Do NOT downgrade or remove `sharp` itself unless absolutely required.

6. Test locally in Replit:
   - Run:
     - `pnpm install`
     - `pnpm build`
     - and, if applicable, `pnpm dev` or `pnpm start`.
   - Confirm that:
     - The build succeeds.
     - The home page and any CMS-dependent pages can be rendered **without “Failed to fetch CMS” errors** in the terminal or browser, assuming the necessary env vars are set in Replit for local testing.
   - If the CMS really cannot be contacted (e.g., bad credentials), then:
     - Show a **graceful fallback** on the frontend instead of a hard crash.
     - Log the detailed error on the server or console, but do not expose secrets.

7. Keep changes minimal and focused:
   - Do NOT introduce new architectural patterns or libraries.
   - Do NOT rename files or folders unless absolutely essential for the bugfix.
   - Do NOT modify Vercel config unless you find a **direct, clear, CMS-related** bug there.

8. At the end, provide a short summary (3–6 bullet points) describing:
   - Which files were changed.
   - What CMS-related code was restored or fixed.
   - What you did (if anything) to the pnpm / sharp config.
   - Which commands you ran to verify that the CMS now loads correctly and the build passes.

Apply all changes directly in this Replit project so that once I push to GitHub, Vercel will deploy a working version again, with both:
- pnpm / sharp build scripts approved correctly, and
- CMS fetching working as before.
